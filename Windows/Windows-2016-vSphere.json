{
  "variables": {
    "iso_url": "./ISO/en_windows_server_2016_x64_01-20-18.iso",
    "iso_checksum_type": "md5",
    "iso_checksum": "8DB0E78BA0DA70A98F29A8CFC437F20E",
    "disk_size": "61440",
    "autounattend": "./Answer-files/2016/Autounattend.xml",
    "sysprep": "./Answer-files/2016/Autounattend_sysprep.xml",
    "template_name": "WinSrv2016x64-Template",
    "winrm_username": "Administrator",
    "winrm_password": "Welcome1!",
    "output_directory":"Server2016-Output"
  },
  "builders": [{
    "type": "vmware-iso",
    "communicator": "winrm",
    "iso_url": "{{user `iso_url`}}",
    "iso_checksum_type": "{{user `iso_checksum_type`}}",
    "iso_checksum": "{{user `iso_checksum`}}",
    "headless": false,
    "boot_wait": "2m",
    "winrm_username": "Administrator",
    "winrm_password": "Welcome1!",
    "winrm_timeout": "2h",
    "shutdown_timeout": "2h",
    "shutdown_command": "a:\\sysprep.bat",
    "guest_os_type": "windows8srv-64",
    "disk_size": 61440,
    "vnc_port_min": 5900,
    "vnc_port_max": 5980,
    "version": 11,
    "output_directory":"{{user `output_directory`}}",
    "floppy_files": [
      "{{user `autounattend`}}",
      "./scripts/sysprep.bat",
      "./scripts/fixnetwork.ps1",
      "./scripts/Enable-Winrm.ps1"
    ],
    "vmx_data": {
      "memsize": "2048",
      "numvcpus": "2",
      "scsi0.virtualDev": "lsisas1068"
    }
  }],
  "provisioners": [{
      "type": "file",
      "source": "{{user `sysprep`}}",
      "destination": "c:/Windows/Temp/Autounattend_sysprep.xml"
    },
    {
      "type": "powershell",
      "elevated_user": "{{user `winrm_username`}}",
      "elevated_password": "{{user `winrm_password`}}",
      "scripts": [
        "./scripts/Install-VMwareTools.ps1",
        "./scripts/Enable-CredSSP.ps1"
      ]
    },
    {
      "type": "windows-update",
      "filters": [
        "include:$true"
      ]
    },
    {
      "type": "windows-restart"
    },
    {
      "type": "powershell",
      "elevated_user": "{{user `winrm_username`}}",
      "elevated_password": "{{user `winrm_password`}}",
      "scripts": [
        "./scripts/Install-NetFramework4.7.2.ps1"
      ]
    }, {
      "type": "windows-restart"
    }
  ],
  "post-processors": [{
    "type": "vsphere",
    "host": "vcenter.lstra.com",
    "username": "administrator@vsphere.local",
    "password": "Welcome1!",
    "insecure": "true",
    "cluster": "esxi-prod.lstra.com",
    "datacenter": "lstra",
    "datastore": "Templates",
    "vm_name": "{{user `template_name`}}",
    "vm_folder": "Templates",
    "disk_mode": "thin",
    "vm_network": "HTB",
    "overwrite": "true"
  }]
}